
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://jmabadlopez.github.io/acceso_datos/site/unidades/ud02/ficheros_acceso_aleatorio/">
      
      
        <link rel="prev" href="../ficheros_binarios/">
      
      
        <link rel="next" href="../documentacion_final/">
      
      
      <link rel="icon" href="../../../assets/images/camp.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Ficheros de acceso aleatorio - Acceso a Datos DAM</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#6-ficheros-de-acceso-aleatorio" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../../.." title="Acceso a Datos DAM" class="md-header__button md-logo" aria-label="Acceso a Datos DAM" data-md-component="logo">
      
  <img src="../../../assets/images/camp.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Acceso a Datos DAM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ficheros de acceso aleatorio
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="orange"  aria-label="Modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="orange"  aria-label="Modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B√∫squeda" placeholder="B√∫squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b√∫squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/jmabadlopez/acceso_datos" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jmabadlopez/acceso_datos
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Pesta√±as" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Inicio

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../ud01/ud01/" class="md-tabs__link">
          
  
  
  Unidades

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navegaci√≥n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Acceso a Datos DAM" class="md-nav__button md-logo" aria-label="Acceso a Datos DAM" data-md-component="logo">
      
  <img src="../../../assets/images/camp.png" alt="logo">

    </a>
    Acceso a Datos DAM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jmabadlopez/acceso_datos" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jmabadlopez/acceso_datos
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inicio
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Unidades
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Unidades
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UD1 - Programaci√≥n en el entorno Kotlin.
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UD2 - Persistencia en ficheros
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            UD2 - Persistencia en ficheros
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducci√≥n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ficheros_directorios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ficheros y directorios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ficheros_texto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ficheros de texto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ficheros_intercambio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ficheros de intercambio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ficheros_binarios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ficheros binarios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Ficheros de acceso aleatorio
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Ficheros de acceso aleatorio
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metodos-de-filechannel" class="md-nav__link">
    <span class="md-ellipsis">
      M√©todos de FileChannel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metodos-de-bytebuffer" class="md-nav__link">
    <span class="md-ellipsis">
      M√©todos de ByteBuffer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metodos-de-control-del-buffer" class="md-nav__link">
    <span class="md-ellipsis">
      M√©todos de control del buffer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="M√©todos de control del buffer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practica-4-modificar-y-eliminar-registros-en-ficheros-dat" class="md-nav__link">
    <span class="md-ellipsis">
      üéØ Pr√°ctica 4: Modificar y eliminar registros en ficheros .dat
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentacion_final/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entrega y documentaci√≥n final
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metodos-de-filechannel" class="md-nav__link">
    <span class="md-ellipsis">
      M√©todos de FileChannel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metodos-de-bytebuffer" class="md-nav__link">
    <span class="md-ellipsis">
      M√©todos de ByteBuffer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metodos-de-control-del-buffer" class="md-nav__link">
    <span class="md-ellipsis">
      M√©todos de control del buffer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="M√©todos de control del buffer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplo
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practica-4-modificar-y-eliminar-registros-en-ficheros-dat" class="md-nav__link">
    <span class="md-ellipsis">
      üéØ Pr√°ctica 4: Modificar y eliminar registros en ficheros .dat
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="6-ficheros-de-acceso-aleatorio">6. Ficheros de acceso aleatorio</h1>
<p>Un fichero de acceso aleatorio es un tipo de fichero que permite leer o escribir en cualquier posici√≥n del fichero directamente, sin necesidad de procesar secuencialmente todo el contenido previo. El sistema puede ‚Äúsaltar‚Äù a una posici√≥n concreta (medida en bytes desde el inicio del fichero) y comenzar la lectura o escritura desde ah√≠. Por ejemplo, si cada registro ocupa 200 bytes, para acceder al registro n√∫mero 100 hay que saltar 200√ó99=19.800 bytes desde el inicio.</p>
<p>Las clases <strong>FileChannel</strong>, <strong>ByteBuffer</strong> y <strong>StandardOpenOption</strong> se utilizan juntas para leer y escribir en ficheros binarios y en el acceso aleatorio a ficheros. <code>ByteBuffer</code> se utiliza en ficheros de acceso aleatorio porque permite leer y escribir bloques binarios de datos en posiciones espec√≠ficas del fichero.</p>
<h2 id="metodos-de-filechannel">M√©todos de FileChannel</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">M√©todo</th>
<th style="text-align: left;">Descripci√≥n</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>position()</code></td>
<td style="text-align: left;">Devuelve la posici√≥n actual del puntero en el fichero y permite saltar a cualquier posici√≥n en √©l (tanto para leer como para escribir).</td>
</tr>
<tr>
<td style="text-align: left;"><code>position(long)</code></td>
<td style="text-align: left;">Establece una posici√≥n exacta para lectura/escritura.</td>
</tr>
<tr>
<td style="text-align: left;"><code>truncate(long)</code></td>
<td style="text-align: left;">Recorta o ampl√≠a el tama√±o del fichero.</td>
</tr>
<tr>
<td style="text-align: left;"><code>size()</code></td>
<td style="text-align: left;">Devuelve el tama√±o total actual del fichero.</td>
</tr>
<tr>
<td style="text-align: left;"><code>read(ByteBuffer)</code>, <code>write(ByteBuffer)</code></td>
<td style="text-align: left;">Usa <code>FileChannel</code> para secuencial o aleatorio.</td>
</tr>
</tbody>
</table>
<h2 id="metodos-de-bytebuffer">M√©todos de ByteBuffer</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">M√©todo</th>
<th style="text-align: left;">Descripci√≥n</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>allocate(capacidad)</code></td>
<td style="text-align: left;">Crea un buffer con capacidad fija en memoria (no compartida).</td>
</tr>
<tr>
<td style="text-align: left;"><code>wrap(byteArray)</code></td>
<td style="text-align: left;">Crea un buffer que envuelve un array de bytes existente (memoria compartida).</td>
</tr>
<tr>
<td style="text-align: left;"><code>wrap(byteArray, offset, length)</code></td>
<td style="text-align: left;">Crea un buffer desde una porci√≥n del array existente.</td>
</tr>
<tr>
<td style="text-align: left;"><code>put(byte)</code>, <code>putInt(int)</code>, <code>putDouble(double)</code>, <code>putFloat(float)</code>, <code>putChar(char)</code>, <code>putShort(short)</code>, <code>putLong(long)</code></td>
<td style="text-align: left;">Escribe un byte, int, double, float, char, short o long en la posici√≥n actual.</td>
</tr>
<tr>
<td style="text-align: left;"><code>put(byte[], offset, length)</code></td>
<td style="text-align: left;">Escribe una porci√≥n de un array de bytes.</td>
</tr>
<tr>
<td style="text-align: left;"><code>get()</code>, <code>getInt()</code>, <code>getDouble()</code>, <code>getFloat()</code>, <code>getChar()</code>, <code>getShort()</code>, <code>getLong()</code></td>
<td style="text-align: left;">Lee un byte, int, double, float, char, short o long desde la posici√≥n actual.</td>
</tr>
<tr>
<td style="text-align: left;"><code>get(byte[], offset, length)</code></td>
<td style="text-align: left;">Lee una porci√≥n del buffer a un array.</td>
</tr>
</tbody>
</table>
<h2 id="metodos-de-control-del-buffer">M√©todos de control del buffer</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">M√©todo</th>
<th style="text-align: left;">Descripci√≥n</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>position()</code></td>
<td style="text-align: left;">Devuelve la posici√≥n actual del cursor.</td>
</tr>
<tr>
<td style="text-align: left;"><code>position(int)</code></td>
<td style="text-align: left;">Establece la posici√≥n del cursor.</td>
</tr>
<tr>
<td style="text-align: left;"><code>limit()</code></td>
<td style="text-align: left;">Devuelve el l√≠mite del buffer.</td>
</tr>
<tr>
<td style="text-align: left;"><code>limit(int)</code></td>
<td style="text-align: left;">Establece un nuevo l√≠mite.</td>
</tr>
<tr>
<td style="text-align: left;"><code>capacity()</code></td>
<td style="text-align: left;">Devuelve la capacidad total del buffer.</td>
</tr>
<tr>
<td style="text-align: left;"><code>clear()</code></td>
<td style="text-align: left;">Limpia el buffer: posici√≥n a 0, l√≠mite al m√°ximo (sin borrar contenido).</td>
</tr>
<tr>
<td style="text-align: left;"><code>flip()</code></td>
<td style="text-align: left;">Prepara el buffer para lectura despu√©s de escribir.</td>
</tr>
<tr>
<td style="text-align: left;"><code>rewind()</code></td>
<td style="text-align: left;">Posici√≥n a 0 para releer desde el inicio.</td>
</tr>
<tr>
<td style="text-align: left;"><code>remaining</code></td>
<td style="text-align: left;">Indica cu√°ntos elementos quedan por procesar.</td>
</tr>
<tr>
<td style="text-align: left;"><code>hasRemaining()</code></td>
<td style="text-align: left;"><code>true</code> si a√∫n queda contenido por leer o escribir.</td>
</tr>
</tbody>
</table>
<p><strong>IMPORTANTE</strong>: un fichero <code>.dat</code> no es un fichero de texto. No se puede abrir con el Bloc de Notas, TextEdit, o un editor de c√≥digo en modo texto normal. Si se abre con estos programas se ve una mezcla de caracteres extra√±os, s√≠mbolos y espacios ("basura"). Hay herramientas online y plugins para los IDE para poder abrir los ficheros y ver la informaci√≥n en binario que contienen.</p>
<h3 id="ejemplo">Ejemplo</h3>
<p>El siguiente ejemplo utiliza <code>FileChannel</code> y <code>ByteBuffer</code> para crear y leer un fichero llamado <code>mediciones.dat</code> con registros con la siguiente estructura:</p>
<ul>
<li>ID del sensor (<code>Int</code> - 4 bytes)</li>
<li>temperatura (<code>Double</code> - 8 bytes)</li>
<li>humedad (<code>Double</code> - 8 bytes)</li>
</ul>
<p>A continuaci√≥n se muestra el c√≥digo con las funciones para a√±adir una medici√≥n al final del fichero y leer todas las mediciones que hay en √©l.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">import</span><span class="w"> </span><span class="nn">java.nio.ByteBuffer</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">import</span><span class="w"> </span><span class="nn">java.nio.ByteOrder</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">java.nio.channels.FileChannel</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">import</span><span class="w"> </span><span class="nn">java.nio.file.Files</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">import</span><span class="w"> </span><span class="nn">java.nio.file.Path</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">import</span><span class="w"> </span><span class="nn">java.nio.file.StandardOpenOption</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">import</span><span class="w"> </span><span class="nn">java.io.IOException</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="c1">// --- CONSTANTES PARA DEFINIR EL TAMA√ëO DE LOS REGISTROS (MUY IMPORTANTE) ---</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="c1">// Definimos el tama√±o exacto de cada campo para garantizar que cada registro ocupe lo mismo.</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TAMANO_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Int</span><span class="p">.</span><span class="na">SIZE_BYTES</span><span class="w">        </span><span class="c1">// 4 bytes para el ID (Int)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TAMANO_NOMBRE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="w">                </span><span class="c1">// 20 bytes fijos para el nombre (String)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TAMANO_TEMPERATURA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Double</span><span class="p">.</span><span class="na">SIZE_BYTES</span><span class="w"> </span><span class="c1">// 8 bytes para la temperatura (Double)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TAMANO_HUMEDAD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Double</span><span class="p">.</span><span class="na">SIZE_BYTES</span><span class="w">     </span><span class="c1">// 8 bytes para la humedad (Double)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1">// Cada registro (medici√≥n) ocupar√° siempre 4 + 20 + 8 + 8 = 40 bytes en el archivo binario.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TAMANO_REGISTRO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TAMANO_ID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TAMANO_NOMBRE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TAMANO_TEMPERATURA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TAMANO_HUMEDAD</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c1">// --- FUNCI√ìN MAIN: PUNTO DE ENTRADA Y FLUJO DE LA APLICACI√ìN ---</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">rutaFichero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;multimedia/bin/mediciones.dat&quot;</span><span class="p">)</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">    </span><span class="c1">// ** Aseguramos que el directorio exista antes de escribir **</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="w">        </span><span class="n">Files</span><span class="p">.</span><span class="na">createDirectories</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">.</span><span class="na">parent</span><span class="p">)</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Directorio creado/verificado: </span><span class="si">${</span><span class="n">rutaFichero</span><span class="p">.</span><span class="na">parent</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="w"> </span><span class="n">IOException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Error al crear el directorio: </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="na">message</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="c1">// Salir si no podemos asegurar la ruta</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="w">    </span><span class="c1">// 1. ESCRITURA: Escribir las 4 mediciones al final del archivo.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">    </span><span class="n">escribirMedicion</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">,</span><span class="w"> </span><span class="m">101</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Atenea&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">25.5</span><span class="p">,</span><span class="w"> </span><span class="m">60.2</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">    </span><span class="n">escribirMedicion</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">,</span><span class="w"> </span><span class="m">102</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hera&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">26.1</span><span class="p">,</span><span class="w"> </span><span class="m">58.9</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="w">    </span><span class="n">escribirMedicion</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">,</span><span class="w"> </span><span class="m">103</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Iris&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">28.4</span><span class="p">,</span><span class="w"> </span><span class="m">65.9</span><span class="p">)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">    </span><span class="n">escribirMedicion</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">,</span><span class="w"> </span><span class="m">104</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Selene&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">28.4</span><span class="p">,</span><span class="w"> </span><span class="m">65.9</span><span class="p">)</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">    </span><span class="c1">// 2. LECTURA: Leer todos los registros escritos.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="w">    </span><span class="n">leerMediciones</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="p">}</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="c1">// --- FUNCI√ìN 1: ESCRIBIR UNA MEDICI√ìN ---</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="c1">// Escribe un registro de tama√±o fijo (40 bytes) al final del fichero binario.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">escribirMedicion</span><span class="p">(</span><span class="n">ruta</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="p">,</span><span class="w"> </span><span class="n">idSensor</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">nombre</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">temperatura</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span><span class="w"> </span><span class="n">humedad</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="w">    </span><span class="c1">// Usamos &#39;APPEND&#39; para a√±adir al final del archivo. El canal se cierra autom√°ticamente con &#39;.use&#39;.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="w">    </span><span class="n">FileChannel</span><span class="p">.</span><span class="na">open</span><span class="p">(</span><span class="n">ruta</span><span class="p">,</span><span class="w"> </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">WRITE</span><span class="p">,</span><span class="w"> </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">CREATE</span><span class="p">,</span><span class="w"> </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">APPEND</span><span class="p">).</span><span class="na">use</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">canal</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="w">        </span><span class="c1">// 1. Configurar el Buffer: Se reserva espacio y se define el orden de bytes nativo.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteBuffer</span><span class="p">.</span><span class="na">allocate</span><span class="p">(</span><span class="n">TAMANO_REGISTRO</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="na">order</span><span class="p">(</span><span class="n">ByteOrder</span><span class="p">.</span><span class="na">nativeOrder</span><span class="p">())</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="w">        </span><span class="c1">// 2. Llenar el Buffer (Modo ESCRITURA): Cada &#39;put&#39; avanza la posici√≥n interna del buffer.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="na">putInt</span><span class="p">(</span><span class="n">idSensor</span><span class="p">)</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="w">        </span><span class="c1">// Manejo del String de tama√±o fijo (20 bytes):</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">nombreCompleto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteArray</span><span class="p">(</span><span class="n">TAMANO_NOMBRE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">.</span><span class="na">code</span><span class="p">.</span><span class="na">toByte</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// 20 bytes rellenos de espacios</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">nombreBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nombre</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">(</span><span class="n">Charsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="w">        </span><span class="n">nombreBytes</span><span class="p">.</span><span class="na">copyInto</span><span class="p">(</span><span class="n">nombreCompleto</span><span class="p">)</span><span class="w"> </span><span class="c1">// Copiamos la cadena, dejando los espacios si es m√°s corta</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">nombreCompleto</span><span class="p">)</span><span class="w"> </span><span class="c1">// Escribe los 20 bytes fijos</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="na">putDouble</span><span class="p">(</span><span class="n">temperatura</span><span class="p">)</span><span class="w"> </span><span class="c1">// Escribe 8 bytes</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="na">putDouble</span><span class="p">(</span><span class="n">humedad</span><span class="p">)</span><span class="w"> </span><span class="c1">// Escribe 8 bytes</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="w">        </span><span class="c1">// 3. Preparar para el Canal: &#39;flip()&#39; cambia el buffer de ESCRITURA a LECTURA.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="w">        </span><span class="c1">//    Establece la posici√≥n a 0 y el l√≠mite al final de los datos que acabamos de poner (40 bytes).</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="na">flip</span><span class="p">()</span>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="w">        </span><span class="c1">// 4. Escribir al Fichero: El canal escribe desde la posici√≥n 0 hasta el l√≠mite del buffer.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="w">        </span><span class="n">canal</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Medici√≥n (ID: </span><span class="si">$</span><span class="n">idSensor</span><span class="s">) escrita correctamente.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="p">}</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="c1">// --- FUNCI√ìN 2: LEER TODAS LAS MEDICIONES ---</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="c1">// Recorre el fichero y lee los registros de 40 bytes uno por uno.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">leerMediciones</span><span class="p">(</span><span class="n">ruta</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Files</span><span class="p">.</span><span class="na">exists</span><span class="p">(</span><span class="n">ruta</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;El fichero </span><span class="si">${</span><span class="n">ruta</span><span class="p">.</span><span class="na">fileName</span><span class="si">}</span><span class="s"> no existe. No hay nada que leer.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="w">    </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;\n--- Leyendo todas las mediciones ---&quot;</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="w">    </span><span class="n">FileChannel</span><span class="p">.</span><span class="na">open</span><span class="p">(</span><span class="n">ruta</span><span class="p">,</span><span class="w"> </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">READ</span><span class="p">).</span><span class="na">use</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">canal</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="w">        </span><span class="c1">// 1. Configurar el Buffer: Buffer del tama√±o exacto de un registro.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteBuffer</span><span class="p">.</span><span class="na">allocate</span><span class="p">(</span><span class="n">TAMANO_REGISTRO</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="na">order</span><span class="p">(</span><span class="n">ByteOrder</span><span class="p">.</span><span class="na">nativeOrder</span><span class="p">())</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="w">        </span><span class="cm">/* 2. Bucle de Lectura: Contin√∫a leyendo mientras el canal logre cargar datos al buffer.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="cm">        `canal.read(buffer)` devuelve la cantidad de bytes le√≠dos (o -1 al final del archivo). */</span>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">canal</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="w">            </span><span class="c1">// 3. Preparar para la Lectura: &#39;flip()&#39; cambia el buffer de ESCRITURA a LECTURA.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="w">            </span><span class="c1">//    Esto nos permite leer los datos que acabamos de cargar desde el inicio.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="w">            </span><span class="n">buffer</span><span class="p">.</span><span class="na">flip</span><span class="p">()</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="w">            </span><span class="c1">// 4. Extraer Datos: Las llamadas &#39;get*&#39; leen los bytes y AVANZAN la posici√≥n.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="na">getInt</span><span class="p">()</span>
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">nombreCompleto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteArray</span><span class="p">(</span><span class="n">TAMANO_NOMBRE</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="w">            </span><span class="n">buffer</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">nombreCompleto</span><span class="p">)</span><span class="w"> </span><span class="c1">// Leemos los 20 bytes del nombre al array.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="w">            </span><span class="c1">// Convertir a String y usar &#39;.trim()&#39; para quitar los espacios de relleno.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="n">nombreCompleto</span><span class="p">,</span><span class="w"> </span><span class="n">Charsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">).</span><span class="na">trim</span><span class="p">()</span>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="na">getDouble</span><span class="p">()</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">hum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="na">getDouble</span><span class="p">()</span>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="w">            </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;  - ID: </span><span class="si">$</span><span class="n">id</span><span class="s">, Nombre: </span><span class="si">$</span><span class="n">nombre</span><span class="s">, Temperatura: </span><span class="si">$</span><span class="n">temp</span><span class="s"> ¬∞C, Humedad: </span><span class="si">$</span><span class="n">hum</span><span class="s"> %&quot;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a><span class="w">            </span><span class="c1">// 5. Preparar para el Siguiente Registro: &#39;clear()&#39; resetea la posici√≥n a 0 y el l√≠mite a la capacidad total.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="w">            </span><span class="c1">//    Esto deja el buffer listo para el siguiente `canal.read()`.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="w">            </span><span class="n">buffer</span><span class="p">.</span><span class="na">clear</span><span class="p">()</span>
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a><span class="p">}</span>
</code></pre></div>
<p>üîç <strong>Ejecuta el ejemplo anterior y comprueba que la salida es la siguiente:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Medici√≥n<span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">101</span><span class="o">)</span><span class="w"> </span>escrita<span class="w"> </span>correctamente.
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>Medici√≥n<span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">102</span><span class="o">)</span><span class="w"> </span>escrita<span class="w"> </span>correctamente.
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>Medici√≥n<span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">103</span><span class="o">)</span><span class="w"> </span>escrita<span class="w"> </span>correctamente.
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>Medici√≥n<span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">104</span><span class="o">)</span><span class="w"> </span>escrita<span class="w"> </span>correctamente.
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>---<span class="w"> </span>Leyendo<span class="w"> </span>todas<span class="w"> </span>las<span class="w"> </span>mediciones<span class="w"> </span>---
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">101</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Atenea,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">25</span>.5<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">60</span>.2<span class="w"> </span>%
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">102</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Hera,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">26</span>.1<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">58</span>.9<span class="w"> </span>%
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">103</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Iris,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">104</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Selene,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
</code></pre></div>
<p>Ahora que ya tenemos la informaci√≥n guardada en nuestro fichero <code>.dat</code> y sabemos leerla, vamos a ampliar la aplicaci√≥n con una funci√≥n que recoge el ID del sensor a modificar y los nuevos datos de temperatura y humedad. Cuando localiza el registro del sensor cuyo ID coincide con el buscado, escribe los nuevos datos en las posiciones de los bytes correspondientes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">// --- FUNCI√ìN 3: ACTUALIZAR UNA MEDICI√ìN EXISTENTE ---</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="c1">// Busca un registro por ID y sobrescribe solo los campos de Temperatura y Humedad.</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">actualizarMedicion</span><span class="p">(</span><span class="n">ruta</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="p">,</span><span class="w"> </span><span class="n">idSensorBuscado</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">nuevaTemperatura</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span><span class="w"> </span><span class="n">nuevaHumedad</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Files</span><span class="p">.</span><span class="na">exists</span><span class="p">(</span><span class="n">ruta</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Error: El fichero no existe, no se puede actualizar.&quot;</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;\nIntentando actualizar medici√≥n para ID: </span><span class="si">$</span><span class="n">idSensorBuscado</span><span class="s">...&quot;</span><span class="p">)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="c1">// Abrimos el canal para LECTURA (b√∫squeda) y ESCRITURA (actualizaci√≥n).</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="n">FileChannel</span><span class="p">.</span><span class="na">open</span><span class="p">(</span><span class="n">ruta</span><span class="p">,</span><span class="w"> </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">READ</span><span class="p">,</span><span class="w"> </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">WRITE</span><span class="p">).</span><span class="na">use</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">canal</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">        </span><span class="c1">// Buffer peque√±o, solo para leer el ID de 4 bytes en cada iteraci√≥n.</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">bufferID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteBuffer</span><span class="p">.</span><span class="na">allocate</span><span class="p">(</span><span class="n">TAMANO_ID</span><span class="p">)</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">        </span><span class="n">bufferID</span><span class="p">.</span><span class="na">order</span><span class="p">(</span><span class="n">ByteOrder</span><span class="p">.</span><span class="na">nativeOrder</span><span class="p">())</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">posicionActual</span><span class="p">:</span><span class="w"> </span><span class="kt">Long</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">encontrado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">        </span><span class="c1">// Bucle que recorre el archivo, leyendo solo el ID en cada registro.</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">canal</span><span class="p">.</span><span class="na">position</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">canal</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">encontrado</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">            </span><span class="n">posicionActual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">canal</span><span class="p">.</span><span class="na">position</span><span class="p">()</span><span class="w"> </span><span class="c1">// Guardamos el byte de inicio del registro.</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">            </span><span class="c1">// 1. Leer solo el ID:</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">            </span><span class="n">bufferID</span><span class="p">.</span><span class="na">clear</span><span class="p">()</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">            </span><span class="n">canal</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">bufferID</span><span class="p">)</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">            </span><span class="n">bufferID</span><span class="p">.</span><span class="na">flip</span><span class="p">()</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">idActual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bufferID</span><span class="p">.</span><span class="na">getInt</span><span class="p">()</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">            </span><span class="c1">// 2. Comprobar ID:</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">idActual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">idSensorBuscado</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="w">                </span><span class="n">encontrado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="w">                </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Sensor </span><span class="si">$</span><span class="n">idSensorBuscado</span><span class="s"> encontrado en la posici√≥n: </span><span class="si">$</span><span class="n">posicionActual</span><span class="s">.&quot;</span><span class="p">)</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">                </span><span class="c1">// 3. Posicionar para la Escritura: Saltamos el ID y el Nombre para ir directo a la Temperatura.</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="w">                </span><span class="c1">// Posici√≥n = (Inicio del Registro) + (Tama√±o ID) + (Tama√±o Nombre)</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">                </span><span class="n">canal</span><span class="p">.</span><span class="na">position</span><span class="p">(</span><span class="n">posicionActual</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TAMANO_ID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TAMANO_NOMBRE</span><span class="p">)</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="w">                </span><span class="c1">// 4. Crear Buffer con nuevos datos (Temperatura y Humedad):</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">bufferDatos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteBuffer</span><span class="p">.</span><span class="na">allocate</span><span class="p">(</span><span class="n">TAMANO_TEMPERATURA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TAMANO_HUMEDAD</span><span class="p">)</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="w">                </span><span class="n">bufferDatos</span><span class="p">.</span><span class="na">order</span><span class="p">(</span><span class="n">ByteOrder</span><span class="p">.</span><span class="na">nativeOrder</span><span class="p">())</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="w">                </span><span class="n">bufferDatos</span><span class="p">.</span><span class="na">putDouble</span><span class="p">(</span><span class="n">nuevaTemperatura</span><span class="p">)</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="w">                </span><span class="n">bufferDatos</span><span class="p">.</span><span class="na">putDouble</span><span class="p">(</span><span class="n">nuevaHumedad</span><span class="p">)</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a><span class="w">                </span><span class="n">bufferDatos</span><span class="p">.</span><span class="na">flip</span><span class="p">()</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a><span class="w">                </span><span class="c1">// 5. Sobrescribir: Escribimos 16 bytes (Temp + Hum) justo encima de los datos antiguos.</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a><span class="w">                </span><span class="n">canal</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">bufferDatos</span><span class="p">)</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a><span class="w">                </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Medici√≥n actualizada con √©xito a Temp: </span><span class="si">$</span><span class="n">nuevaTemperatura</span><span class="s"> ¬∞C, Hum: </span><span class="si">$</span><span class="n">nuevaHumedad</span><span class="s"> %.&quot;</span><span class="p">)</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a><span class="w">                </span><span class="c1">// 6. Si no es el ID, saltar al inicio del siguiente registro completo.</span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="w">                </span><span class="n">canal</span><span class="p">.</span><span class="na">position</span><span class="p">(</span><span class="n">posicionActual</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TAMANO_REGISTRO</span><span class="p">)</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">encontrado</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a><span class="w">            </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Medici√≥n con ID: </span><span class="si">$</span><span class="n">idSensorBuscado</span><span class="s"> no encontrada.&quot;</span><span class="p">)</span>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="p">}</span>
</code></pre></div>
<p>La llamada a esta nueva funci√≥n en el main podr√≠a ser:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">actualizarMedicion</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">,</span><span class="w"> </span><span class="m">102</span><span class="p">,</span><span class="w"> </span><span class="m">21.0</span><span class="p">,</span><span class="w"> </span><span class="m">72.3</span><span class="p">)</span>
</code></pre></div>
<p>Se vuelve a llamar a <code>leerMediciones</code> para comprobar que la informaci√≥n del sensor se ha modificado correctamente:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">leerMediciones</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">)</span>
</code></pre></div>
<p>üîç <strong>Realiza los siguientes pasos:</strong></p>
<ul>
<li>A√±ade el c√≥digo de la funci√≥n <code>actualizarMedicion()</code> al proyecto del ejemplo anterior.</li>
<li>Comenta en el <code>main</code> las llamadas a la funci√≥n <code>escribirMedicion()</code>.</li>
<li>A√±ade al <code>main</code> las llamadas a <code>actualizarMedicion()</code> y a <code>leerMediciones()</code>.</li>
<li><strong>Ejecuta la aplicaci√≥n y comprueba que la salida es la siguiente:</strong></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>---<span class="w"> </span>Leyendo<span class="w"> </span>todas<span class="w"> </span>las<span class="w"> </span>mediciones<span class="w"> </span>---
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">101</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Atenea,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">25</span>.5<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">60</span>.2<span class="w"> </span>%
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">102</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Hera,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">26</span>.1<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">58</span>.9<span class="w"> </span>%
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">103</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Iris,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">104</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Selene,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>Intentando<span class="w"> </span>actualizar<span class="w"> </span>medici√≥n<span class="w"> </span>para<span class="w"> </span>ID:<span class="w"> </span><span class="m">102</span>...
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>leyendo<span class="w"> </span>ID:<span class="w"> </span><span class="m">101</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>leyendo<span class="w"> </span>ID:<span class="w"> </span><span class="m">102</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>Sensor<span class="w"> </span><span class="m">102</span><span class="w"> </span>en<span class="w"> </span>posici√≥n<span class="w"> </span><span class="m">40</span>.
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>Medici√≥n<span class="w"> </span>actualizada<span class="w"> </span>con<span class="w"> </span>√©xito<span class="w"> </span>a<span class="w"> </span>Temp:<span class="w"> </span><span class="m">21</span>.0,<span class="w"> </span>Hum:<span class="w"> </span><span class="m">72</span>.3.
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>---<span class="w"> </span>Leyendo<span class="w"> </span>todas<span class="w"> </span>las<span class="w"> </span>mediciones<span class="w"> </span>---
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">101</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Atenea,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">25</span>.5<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">60</span>.2<span class="w"> </span>%
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">102</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Hera,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">21</span>.0<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">72</span>.3<span class="w"> </span>%
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">103</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Iris,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">104</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Selene,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
</code></pre></div>
<p>Por √∫ltimo, ampliaremos la aplicaci√≥n para poder eliminar los datos de un sensor a partir de su ID. El programa recorre todo los registros comprobando si el ID coincide con el buscado. En caso de que no coincida escribe el registro en un fichero temporal y si coincide, no hace nada. Al finalizar el fichero temporal contendr√° los registros que no se quieren eliminar. Por √∫ltimo, se elimina el fichero original y se renombra el fichero temporal con el nombre original.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1">// --- FUNCI√ìN 4: ELIMINAR UNA MEDICI√ìN ---</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="cm">/* La eliminaci√≥n en ficheros binarios de tama√±o fijo se hace recreando el fichero.</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="cm">Se lee el archivo original registro por registro, y se copia todo excepto el registro a eliminar. */</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">eliminarMedicion</span><span class="p">(</span><span class="n">ruta</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="p">,</span><span class="w"> </span><span class="n">idSensorAEliminar</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="c1">// 1. Definir ruta temporal en el mismo directorio que el original.</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">rutaTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">ruta</span><span class="p">.</span><span class="na">parent</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;temp_mediciones.dat&quot;</span><span class="p">)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">registroEliminado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Files</span><span class="p">.</span><span class="na">exists</span><span class="p">(</span><span class="n">ruta</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">        </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Error: El fichero </span><span class="si">${</span><span class="n">ruta</span><span class="p">.</span><span class="na">name</span><span class="si">}</span><span class="s"> no existe, no se puede eliminar.&quot;</span><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="n">println</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;\n--- Intentando eliminar medici√≥n para el sensor con ID: </span><span class="si">$</span><span class="n">idSensorAEliminar</span><span class="s">... ---&quot;</span><span class="p">)</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="c1">// 2. Nos aseguramos de que el archivo temporal est√© limpio antes de empezar a escribir.</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span><span class="n">Files</span><span class="p">.</span><span class="na">deleteIfExists</span><span class="p">(</span><span class="n">rutaTemp</span><span class="p">)</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="c1">// Abrimos el canal del archivo original para LECTURA.</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">    </span><span class="n">FileChannel</span><span class="p">.</span><span class="na">open</span><span class="p">(</span><span class="n">ruta</span><span class="p">,</span><span class="w"> </span><span class="n">StandardOpenOption</span><span class="p">.</span><span class="na">READ</span><span class="p">).</span><span class="na">use</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">canalOrigen</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">        </span><span class="c1">// Buffer de tama√±o de registro completo (40 bytes).</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteBuffer</span><span class="p">.</span><span class="na">allocate</span><span class="p">(</span><span class="n">TAMANO_REGISTRO</span><span class="p">)</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="na">order</span><span class="p">(</span><span class="n">ByteOrder</span><span class="p">.</span><span class="na">nativeOrder</span><span class="p">())</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">        </span><span class="c1">// 3. Recorremos el archivo original, leyendo cada registro completo.</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">canalOrigen</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">            </span><span class="n">buffer</span><span class="p">.</span><span class="na">flip</span><span class="p">()</span><span class="w"> </span><span class="c1">// Poner en modo lectura</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">            </span><span class="c1">// Leemos el ID (sin avanzar el buffer para no estropearlo)</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="c1">// Usamos getInt(0) para leer sin mover la posici√≥n</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">idSensorAEliminar</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">                </span><span class="c1">// Si el ID NO coincide, copiamos el registro completo.</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="w">                </span><span class="c1">// Rebobinamos el buffer (posici√≥n a 0, l√≠mite se mantiene)</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">                </span><span class="n">buffer</span><span class="p">.</span><span class="na">rewind</span><span class="p">()</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="w">                </span><span class="c1">// El registro completo (40 bytes) se escribe en el archivo temporal.</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="w">                </span><span class="c1">// La funci√≥n escribirMedicion() que usa APPEND se encargar√° de esto.</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">                </span><span class="c1">// --- Extracci√≥n y Escritura en temporal ---</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">nombreCompleto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteArray</span><span class="p">(</span><span class="n">TAMANO_NOMBRE</span><span class="p">)</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="w">                </span><span class="c1">// Ahora s√≠ leemos los datos, ya que estamos listos para pasar al siguiente registro.</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="w">                </span><span class="n">buffer</span><span class="p">.</span><span class="na">getInt</span><span class="p">()</span><span class="w"> </span><span class="c1">// Consumimos el ID</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="w">                </span><span class="n">buffer</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">nombreCompleto</span><span class="p">)</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="n">nombreCompleto</span><span class="p">,</span><span class="w"> </span><span class="n">Charsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">).</span><span class="na">trim</span><span class="p">()</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="na">getDouble</span><span class="p">()</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">hum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="na">getDouble</span><span class="p">()</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="w">                </span><span class="n">escribirMedicion</span><span class="p">(</span><span class="n">rutaTemp</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">nombre</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">hum</span><span class="p">)</span><span class="w"> </span><span class="c1">// Escribimos en el nuevo fichero</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="w">                </span><span class="c1">// ----------------------------------------</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="w">                </span><span class="c1">// Si el ID COINCIDE, la funci√≥n simplemente NO llama a escribirMedicion().</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="w">                </span><span class="n">registroEliminado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="w">                </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;-&gt; Eliminado registro con ID: </span><span class="si">$</span><span class="n">idSensorAEliminar</span><span class="s">.&quot;</span><span class="p">)</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="w">            </span><span class="n">buffer</span><span class="p">.</span><span class="na">clear</span><span class="p">()</span><span class="w"> </span><span class="c1">// Dejar el buffer limpio para la siguiente carga del canal.</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// El canal de lectura se cierra autom√°ticamente aqu√≠.</span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="w">    </span><span class="c1">// 4. Finalizaci√≥n: Reemplazar el archivo original con el temporal si se encontr√≥ algo.</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">registroEliminado</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="w">        </span><span class="n">Files</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">ruta</span><span class="p">)</span><span class="w"> </span><span class="c1">// Borramos el fichero original (que a√∫n tiene el registro a eliminar).</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="w">        </span><span class="n">Files</span><span class="p">.</span><span class="na">move</span><span class="p">(</span><span class="n">rutaTemp</span><span class="p">,</span><span class="w"> </span><span class="n">ruta</span><span class="p">)</span><span class="w"> </span><span class="c1">// Renombramos el temporal (que NO tiene el registro).</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;--- Eliminaci√≥n completada. Archivo </span><span class="si">${</span><span class="n">ruta</span><span class="p">.</span><span class="na">name</span><span class="si">}</span><span class="s"> actualizado ---&quot;</span><span class="p">)</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a><span class="w">        </span><span class="c1">// Si no se encontr√≥ el ID, eliminamos el archivo temporal (vac√≠o o incompleto) y mantenemos el original.</span>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="w">        </span><span class="n">Files</span><span class="p">.</span><span class="na">deleteIfExists</span><span class="p">(</span><span class="n">rutaTemp</span><span class="p">)</span>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a><span class="w">        </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;--- Medici√≥n con ID: </span><span class="si">$</span><span class="n">idSensorAEliminar</span><span class="s"> no encontrada. El archivo original no fue modificado. ---&quot;</span><span class="p">)</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a><span class="p">}</span>
</code></pre></div>
<p>La llamada a esta nueva funci√≥n en el main podr√≠a ser:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">eliminarMedicion</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">,</span><span class="w"> </span><span class="m">102</span><span class="p">)</span>
</code></pre></div>
<p>Se vuelve a llamar a <code>leerMediciones</code> para comprobar que la informaci√≥n del sensor se ha modificado correctamente:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">leerMediciones</span><span class="p">(</span><span class="n">rutaFichero</span><span class="p">)</span>
</code></pre></div>
<p>üîç <strong>Realiza los siguientes pasos:</strong></p>
<ul>
<li>A√±ade el c√≥digo de la funci√≥n <code>eliminarMedicion()</code> al ejemplo anterior.</li>
<li>Comenta en el <code>main</code> la llamada a la funci√≥n <code>actualizarMedicion()</code>.</li>
<li>A√±ade al <code>main</code> la llamada a <code>eliminarMedicion()</code>.</li>
<li><strong>Ejecuta la aplicaci√≥n y comprueba que la salida es la siguiente:</strong></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>---<span class="w"> </span>Leyendo<span class="w"> </span>todas<span class="w"> </span>las<span class="w"> </span>mediciones<span class="w"> </span>---
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">101</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Atenea,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">25</span>.5<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">60</span>.2<span class="w"> </span>%
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">102</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Hera,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">21</span>.0<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">72</span>.3<span class="w"> </span>%
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">103</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Iris,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">104</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Selene,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>Intentando<span class="w"> </span>eliminar<span class="w"> </span>medici√≥n<span class="w"> </span>para<span class="w"> </span>el<span class="w"> </span>sensor<span class="w"> </span>con<span class="w"> </span>ID:<span class="w"> </span><span class="m">102</span>...
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>Medici√≥n<span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">101</span><span class="o">)</span><span class="w"> </span>escrita<span class="w"> </span>correctamente.
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>Medici√≥n<span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">103</span><span class="o">)</span><span class="w"> </span>escrita<span class="w"> </span>correctamente.
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>Medici√≥n<span class="w"> </span><span class="o">(</span>ID:<span class="w"> </span><span class="m">104</span><span class="o">)</span><span class="w"> </span>escrita<span class="w"> </span>correctamente.
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>---<span class="w"> </span>Leyendo<span class="w"> </span>todas<span class="w"> </span>las<span class="w"> </span>mediciones<span class="w"> </span>---
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">101</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Atenea,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">25</span>.5<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">60</span>.2<span class="w"> </span>%
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">103</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Iris,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">  </span>-<span class="w"> </span>ID:<span class="w"> </span><span class="m">104</span>,<span class="w"> </span>Nombre:<span class="w"> </span>Selene,<span class="w"> </span>Temperatura:<span class="w"> </span><span class="m">28</span>.4<span class="w"> </span>¬∞C,<span class="w"> </span>Humedad:<span class="w"> </span><span class="m">65</span>.9<span class="w"> </span>%
</code></pre></div>
<hr />
<h2 id="practica-4-modificar-y-eliminar-registros-en-ficheros-dat">üéØ Pr√°ctica 4: Modificar y eliminar registros en ficheros .dat</h2>
<p>Realiza lo siguiente:</p>
<ul>
<li><strong>Siguiendo con tu Proyecto anterior</strong>: Crea una nueva estructura para registrar los datos que has definido pero en modo <strong>Fichero de Acceso Aleatorio</strong>.</li>
<li><strong>Crea las funciones</strong> <code>escribirMediciones()</code>y <code>leerMediciones()</code>. Adaptlo a tus datos.</li>
<li><strong>Crea la funci√≥n <code>modificarReg()</code></strong>: Pedir√° al usuario el ID del registro a modificar y buscar√° ese registro en el fichero. Si lo encuentra, pedir√° los nuevos datos. Utilizar√° acceso aleatorio (<code>FileChannel.position()</code>) para saltar a la posici√≥n exacta de ese registro y sobrescribir √∫nicamente los campos modificados, sin alterar el resto del fichero.</li>
<li><strong>Crea la funci√≥n <code>eliminarReg()</code></strong>: Debe recibir un ID y eliminar el registro correspondiente. Implementa la t√©cnica de streaming (leer el fichero original registro a registro, escribir los que se conservan en un fichero temporal, borrar el original y renombrar el temporal).</li>
<li><strong>Comprueba</strong>: Prueba estas funciones desde <code>main</code>, llamando a <code>leerMediciones()</code> antes y despu√©s de cada operaci√≥n para verificar los resultados.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Pie" >
        
          
          <a href="../ficheros_binarios/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Ficheros binarios">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                Ficheros binarios
              </div>
            </div>
          </a>
        
        
          
          <a href="../documentacion_final/" class="md-footer__link md-footer__link--next" aria-label="Siguiente: Entrega y documentaci√≥n final">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Siguiente
              </span>
              <div class="md-ellipsis">
                Entrega y documentaci√≥n final
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.top", "optimize", "content.code.copy", "navigation.footer", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>